<!-- Dot Grid Background -->
<div class="app-bg"></div>

<!-- Main Generator Layout -->
<main class="generator-page">
  <div class="generator-layout">
    <!-- FORGE PANEL (Left Column) -->
    <aside class="forge-column">
      <div class="panel forge-panel">
        <!-- Panel Header -->
        <header class="panel-header">
          <div class="panel-title-row">
            <svg
              class="panel-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
              />
            </svg>
            <h2 class="panel-title">The Forge</h2>
          </div>
          <p class="panel-subtitle">Craft your next viral thread</p>
        </header>

        <!-- Form Content -->
        <div class="forge-form">
          <!-- Topic Input -->
          <div class="form-group">
            <label class="form-label" for="topic">
              Topic
              <span class="required-indicator">*</span>
            </label>
            <input
              type="text"
              id="topic"
              class="input"
              [class.error]="topicError()"
              placeholder="What do you want to write about?"
              [ngModel]="topic()"
              (ngModelChange)="topic.set($event)"
              (blur)="onTopicBlur()"
              maxlength="140"
            />
            @if (topicError()) {
              <span class="form-error">{{ topicError() }}</span>
            }
            <span class="form-hint">{{ topic().trim().length }}/120 characters</span>
          </div>

          <!-- Audience Input -->
          <div class="form-group">
            <label class="form-label" for="audience"> Audience (optional) </label>
            <input
              type="text"
              id="audience"
              class="input"
              [class.error]="audienceError()"
              placeholder="Indie hackers, founders, developers..."
              [ngModel]="audience()"
              (ngModelChange)="audience.set($event)"
              (blur)="onAudienceBlur()"
              maxlength="100"
            />
            @if (audienceError()) {
              <span class="form-error">{{ audienceError() }}</span>
            }
          </div>

          <!-- Tone Selector -->
          <div class="form-group">
            <span class="form-label" id="tone-label">Tone</span>
            <div class="tone-selector" role="radiogroup" aria-labelledby="tone-label">
              @for (tone of toneOptions; track tone.value) {
                <button
                  type="button"
                  class="tone-pill"
                  role="radio"
                  [attr.aria-checked]="selectedTone() === tone.value"
                  [class.active]="selectedTone() === tone.value"
                  (click)="selectTone(tone.value)"
                >
                  {{ tone.label }}
                </button>
              }
            </div>
          </div>

          <!-- Tweet Count Slider -->
          <div class="form-group">
            <label class="form-label" for="tweet-count">
              Thread Length
              <span class="tweet-count-badge">{{ tweetCount() }} tweets</span>
            </label>
            <div class="slider-container">
              <span class="slider-label">Short</span>
              <input
                type="range"
                id="tweet-count"
                min="5"
                max="12"
                step="1"
                [ngModel]="tweetCount()"
                (ngModelChange)="tweetCount.set($event)"
              />
              <span class="slider-label">Long</span>
            </div>
            <div class="slider-ticks">
              @for (n of [5, 6, 7, 8, 9, 10, 11, 12]; track n) {
                <span class="tick" [class.active]="tweetCount() === n">
                  {{ n }}
                </span>
              }
            </div>
          </div>

          <!-- Generate Button -->
          <button
            type="button"
            class="button-primary generate-button"
            [disabled]="!isFormValid() || isGenerating()"
            [attr.aria-busy]="isGenerating()"
            (click)="onGenerate()"
          >
            <svg
              *ngIf="!isGenerating()"
              class="button-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              aria-hidden="true"
            >
              <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
            </svg>
            <div *ngIf="isGenerating()" class="button-spinner" aria-hidden="true"></div>
            {{ isGenerating() ? 'Generating...' : 'Generate' }}
          </button>

          <!-- Regenerate Section (visible when thread exists) -->
          @if (generatedThread()) {
            <button
              type="button"
              class="regenerate-button"
              [disabled]="isGenerating()"
              (click)="onRegenerate()"
            >
              <svg
                class="button-icon-sm"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="23 4 23 10 17 10" />
                <polyline points="1 20 1 14 7 14" />
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" />
              </svg>
              Regenerate
            </button>

            <!-- Feedback Toggle -->
            <div class="feedback-section">
              <button type="button" class="feedback-toggle" (click)="toggleFeedback()">
                {{ showFeedback() ? 'âˆ’ Hide feedback' : '+ Add feedback' }}
              </button>

              @if (showFeedback()) {
                <input
                  type="text"
                  class="feedback-input"
                  [class.error]="feedbackError()"
                  placeholder="e.g., Make it more provocative, add statistics..."
                  [ngModel]="feedback()"
                  (ngModelChange)="feedback.set($event)"
                  (keydown)="onFeedbackKeydown($event)"
                  maxlength="220"
                />
                @if (feedbackError()) {
                  <span class="form-error">{{ feedbackError() }}</span>
                }
                <span class="form-hint feedback-hint"
                  >{{ feedback().trim().length }}/200 characters</span
                >
              }
            </div>
          }
        </div>
      </div>

      <!-- Powered By Badge -->
      <div class="powered-by">
        <span class="powered-by-text">Powered by</span>
        <span class="powered-by-brand">xAI Grok</span>
      </div>
    </aside>

    <!-- PREVIEW PANEL (Right Column) -->
    <section class="preview-column">
      <div class="panel preview-panel">
        <!-- Panel Header -->
        <header class="panel-header">
          <div class="panel-title-row">
            <svg
              class="panel-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
              <line x1="3" y1="9" x2="21" y2="9" />
              <line x1="9" y1="21" x2="9" y2="9" />
            </svg>
            <h2 class="panel-title">Preview</h2>
          </div>
        </header>

        <!-- Thread Preview Component -->
        <app-thread-preview
          [tweets]="generatedThread()"
          [isGenerating]="isGenerating()"
          (tweetEdited)="onTweetEdited($event)"
        >
        </app-thread-preview>
      </div>
    </section>
  </div>
</main>
